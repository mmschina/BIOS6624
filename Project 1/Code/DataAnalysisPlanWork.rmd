---
title: "Project 1 - Data Analysis Plan"
author: "Madelynn Schina"
date: "February 2026"
output: pdf_document
---


```{r, include=F} 
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(here)
library(dplyr)
library(ggplot2)
library(gtsummary)
library(gt)
library(moments)

```


```{r, echo = F}
# Loading dataset
hiv_data <- read.csv(here("Project 1/Data", "hiv_6624_final.csv"))

```


Questions of Interest: How treatment response 2 years after initiating HAART differs between subjects who report using hard drugs, such as heroin and cocaine, at baseline and other subjects, who did not report hard drug use at baseline.
Overarching Question: Could hard_drug explain difference in adherence?


Variables of Interest:  VLOAD, LEU3N, AGG_PHYS, AGG_MENT
Primary Predictor:  hard_drugs at baseline
Covariates Adjusting for:  ADH, RACE, EDUCBAS, SMOKE


```{r, echo = F}
# Since we are only interested in response 2 years after starting treatment, all visits/years after 2 can be excluded
# Subsetting dataset to only baseline, year 1 and year 2.
hiv_data <- hiv_data %>%
  filter(years <= 2)

```

```{r, echo = F}
# Creating table of patients counts for each of the three visits to observe missingness
missingness_by_visit <- hiv_data %>%
  group_by(years) %>%
  summarise(n_patients = n())

print(missingness_by_visit)
```


715 unique individuals in the study, we have a baseline visit for each of them.
190 of those patients are missing a visit at year 1
An additional 19, totally 209 of the total, are missing a visit at year 2


```{r, echo = F}
# Note that we are only interested in hard_drugs indicator at baseline and not during the study
# Creating hard_drugs_baseline variable for each patient
hiv_data <- hiv_data %>%
  group_by(newid) %>%
  mutate(hard_drugs_baseline = hard_drugs[years == 0]) %>%
  ungroup()

```


```{r, echo = F}
# Descriptive Statistics of variables of interest in the dataset
summary_data <- hiv_data %>%
  select(years, VLOAD, LEU3N, AGG_PHYS, AGG_MENT, hard_drugs_baseline, ADH, RACE, EDUCBAS, SMOKE)

# Renaming ADH, RACE, EDUCBAS, and SMOKE for table
summary_data <- summary_data %>%
  mutate(ADH = factor(ADH,
                      levels = c(1, 2, 3, 4),
                      labels = c("100%", "95-99%", "75-94%", "<75%")),
         RACE = factor(RACE,
                       levels = c(1, 2, 3, 4, 5, 6, 7, 8),
                       labels = c("White, Non-Hispanic",
                                  "White, Hispanic",
                                  "Black, Non-Hispanic",
                                  "Black, Hispanic",
                                  "American Indian or Alaskan Native",
                                  "Asian or Pacific Islander",
                                  "Other",
                                  "Other Hispanic")),
         EDUCBAS = factor(EDUCBAS,
                          levels = c(1, 2, 3, 4, 5, 6, 7),
                          labels = c("8th grade or less",
                                     "9, 10, or 11th grade",
                                     "12th grade",
                                     "At least one year college but no degree",
                                     "Four years college / got degree",
                                     "Some graduate work",
                                     "Post-graduate degree")),
         SMOKE = factor(SMOKE,
                        levels = c(1, 2, 3),
                        labels = c("Never smoked",
                                   "Former smoker",
                                   "Current smoker")))

# Creating summary table
descriptive_table <- tbl_summary(summary_data,
                                 by = years,
                                 missing = "ifany",
                                 statistic = all_continuous() ~ "{mean} ({sd})",
                                 label = list(VLOAD ~ "Viral Load (copies/mL)",
                                              LEU3N ~ "CD4+ T Cell Count (# of cells)",
                                              AGG_PHYS ~ "Physical QOL Score",
                                              AGG_MENT ~ "Mental Health QOL Score",
                                              hard_drugs_baseline ~ "Hard Drug Use Prior to Treatment",
                                              ADH ~ "Adherence",
                                              RACE ~ "Race",
                                              EDUCBAS ~ "Highest Education Reached",
                                              SMOKE ~ "Smoking Status")) %>%
  add_overall() %>%
  modify_table_body(~ .x %>%
                      dplyr::mutate(label = ifelse(label == "Unknown", "Missing", label)))

# Save table as image for report
gtsave(as_gt(descriptive_table), "descriptivetable.png")

```



Evaluating outcomes of interest to determine if transformations are necessary

```{r, echo = F}
## Initial plots of distributions
# Histogram of Viral Load
ggplot(hiv_data, aes(x = VLOAD)) +
  geom_histogram(fill = "cornflowerblue", color = "black") +
  labs(x = "Viral Load",
       y = "Count")

# Histogram of T-Cell Count
ggplot(hiv_data, aes(x = LEU3N)) +
  geom_histogram(fill = "cornflowerblue", color = "black", binwidth = 50) +
  labs(x = "T-Cell Count",
       y = "Count")

# Histogram of QOL Mental Score
ggplot(hiv_data, aes(x = AGG_MENT)) +
  geom_histogram(fill = "cornflowerblue", color = "black") +
  labs(x = "QOL Mental",
       y = "Count")

# Histogram of QOL Physical Score
ggplot(hiv_data, aes(x = AGG_PHYS)) +
  geom_histogram(fill = "cornflowerblue", color = "black") +
  labs(x = "QOL Mental",
       y = "QOL Physical")


# Testing skewness using the moment package
skewness(hiv_data$VLOAD, na.rm = TRUE)
skewness(hiv_data$LEU3N, na.rm = TRUE)
skewness(hiv_data$AGG_MENT, na.rm = TRUE)
skewness(hiv_data$AGG_PHYS, na.rm = TRUE)

```


Appears that log transforming Viral Load may be appropriate. Other three variables look ok without transformations, residual plots of final models will be assessed to confirm this.


```{r, echo = F}
# Assessing if log transforming Viral Load is appropriate
ggplot(hiv_data, aes(x = log(VLOAD))) +
  geom_histogram(fill = "cornflowerblue", color = "black") +
  labs(x = "Viral Load",
       y = "Count")

# Log transforming Viral Load in the dataset
hiv_data <- hiv_data %>%
  mutate(log_vload = log(VLOAD + 1))



```




