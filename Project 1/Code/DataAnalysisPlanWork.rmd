---
title: "Project 1 - Data Analysis Plan"
author: "Madelynn Schina"
date: "February 2026"
output: pdf_document
---


```{r, include=F} 
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(here)
library(dplyr)
library(ggplot2)
library(gtsummary)
library(gt)
library(moments)

```


```{r, echo = F}
# Loading dataset
hiv_data <- read.csv(here("Project 1/Data", "hiv_6624_final.csv"))

```


Questions of Interest: How treatment response 2 years after initiating HAART differs between subjects who report using hard drugs, such as heroin and cocaine, at baseline and other subjects, who did not report hard drug use at baseline.
Overarching Question: Could hard_drug explain difference in adherence?


Variables of Interest:  VLOAD, LEU3N, AGG_PHYS, AGG_MENT
Primary Predictor:  hard_drugs at baseline
Covariates Adjusting for:  ADH, RACE, EDUCBAS, SMOKE


```{r, echo = F}
# Since we are only interested in response 2 years after starting treatment, all visits/years after 2 can be excluded
# Subsetting dataset to only baseline and year 2.
hiv_data <- hiv_data %>%
  filter(years %in% c(0,2))

# Removing any individuals missing either baseline or visit at year 2 
hiv_data_cleaned <- hiv_data %>%
  group_by(newid) %>%
  filter(n() == 2) %>%
  ungroup() 

```


```{r, echo = F}
# Checking that age increases by exactly 2 years for everyone
age_check <- hiv_data_cleaned %>%
  group_by(newid) %>%
  summarise(
    age_baseline = age[years == 0],
    age_year2 = age[years == 2],
    age_difference = age_year2 - age_baseline,
    .groups = 'drop'
  )

problems <- age_check %>%
  filter(age_difference != 2)

# No subject aged as we didn't expect, so we can use baseline_age without time variation

```


```{r, echo = F}
# Note that we are only interested in hard_drugs indicator at baseline and not during the study
# Creating hard_drugs_baseline variable and baseline_age variable for each patient
hiv_data_cleaned <- hiv_data_cleaned %>%
  group_by(newid) %>%
  mutate(hard_drugs_baseline = hard_drugs[years == 0]) %>%
  mutate(baseline_age = age[years == 0]) %>%
  ungroup()

```


```{r, echo = F}
# Descriptive Statistics of variables of interest in the dataset
summary_data <- hiv_data_cleaned %>%
  filter(years == 0) %>%
  select(VLOAD, LEU3N, AGG_PHYS, AGG_MENT, hard_drugs_baseline, baseline_age, BMI, RACE, EDUCBAS, SMOKE)

# Renaming ADH, RACE, EDUCBAS, and SMOKE for table
summary_data <- summary_data %>%
  mutate(RACE = factor(RACE,
                       levels = c(1, 2, 3, 4, 5, 6, 7, 8),
                       labels = c("White, Non-Hispanic",
                                  "White, Hispanic",
                                  "Black, Non-Hispanic",
                                  "Black, Hispanic",
                                  "American Indian or Alaskan Native",
                                  "Asian or Pacific Islander",
                                  "Other",
                                  "Other Hispanic")),
         EDUCBAS = factor(EDUCBAS,
                          levels = c(1, 2, 3, 4, 5, 6, 7),
                          labels = c("8th grade or less",
                                     "9, 10, or 11th grade",
                                     "12th grade",
                                     "At least one year college but no degree",
                                     "Four years college / got degree",
                                     "Some graduate work",
                                     "Post-graduate degree")),
         SMOKE = factor(SMOKE,
                        levels = c(1, 2, 3),
                        labels = c("Never smoked",
                                   "Former smoker",
                                   "Current smoker")),
         hard_drugs_baseline = factor(hard_drugs_baseline,
                                      levels = c(0,1),
                                      labels = c("No Hard Drug Use", "Hard Drug Use")))

# Creating summary table
descriptive_table <- tbl_summary(summary_data,
                                 by = hard_drugs_baseline,
                                 missing = "ifany",
                                 statistic = all_continuous() ~ "{mean} ({sd})",
                                 label = list(VLOAD ~ "Viral Load (copies/mL)",
                                              LEU3N ~ "CD4+ T Cell Count (# of cells)",
                                              AGG_PHYS ~ "Physical QOL Score",
                                              AGG_MENT ~ "Mental Health QOL Score",
                                              RACE ~ "Race",
                                              EDUCBAS ~ "Highest Education Reached",
                                              SMOKE ~ "Smoking Status",
                                              baseline_age ~ "Age (years)")) %>%
  add_overall() %>%
  modify_table_body(~ .x %>%
                      dplyr::mutate(label = ifelse(label == "Unknown", "Missing", label)))

# Save table as image for report
gtsave(as_gt(descriptive_table), "descriptivetable.png")

```



Evaluating outcomes of interest to determine if transformations are necessary

```{r, echo = F}
## Initial plots of distributions
# Histogram of Viral Load
ggplot(hiv_data_cleaned, aes(x = VLOAD)) +
  geom_histogram(fill = "cornflowerblue", color = "black") +
  labs(x = "Viral Load",
       y = "Count")

# Histogram of T-Cell Count
ggplot(hiv_data_cleaned, aes(x = LEU3N)) +
  geom_histogram(fill = "cornflowerblue", color = "black", binwidth = 50) +
  labs(x = "T-Cell Count",
       y = "Count")

# Histogram of QOL Mental Score
ggplot(hiv_data_cleaned, aes(x = AGG_MENT)) +
  geom_histogram(fill = "cornflowerblue", color = "black") +
  labs(x = "QOL Mental",
       y = "Count")

# Histogram of QOL Physical Score
ggplot(hiv_data_cleaned, aes(x = AGG_PHYS)) +
  geom_histogram(fill = "cornflowerblue", color = "black") +
  labs(x = "QOL Mental",
       y = "QOL Physical")


# Testing skewness using the moment package
skewness(hiv_data_cleaned$VLOAD, na.rm = TRUE)
skewness(hiv_data_cleaned$LEU3N, na.rm = TRUE)
skewness(hiv_data_cleaned$AGG_MENT, na.rm = TRUE)
skewness(hiv_data_cleaned$AGG_PHYS, na.rm = TRUE)

```


Appears that log transforming Viral Load may be appropriate. Other three variables look ok without transformations, residual plots of final models will be assessed to confirm this.


```{r, echo = F}
# Assessing if log transforming Viral Load is appropriate
ggplot(hiv_data_cleaned, aes(x = log(VLOAD))) +
  geom_histogram(fill = "cornflowerblue", color = "black") +
  labs(x = "Viral Load",
       y = "Count")

# Log transforming Viral Load in the dataset
hiv_data_cleaned <- hiv_data_cleaned %>%
  mutate(log_vload = log(VLOAD))

```




